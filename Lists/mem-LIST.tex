%%%%%
%%
%% This file sets up the Mem, MemFold, and MemEnvelope datatypes, and
%% creates possible macros for each.
%%
%% The Mem datatype isn't really used directly; it's there so the
%% other datatypes can inherit and share its code.
%%
%%%%%

\DECLARESUBTYPE{Mem}{Element}
\PRESETS{Mem}{
  %% \MYname is the trigger
  \F\MYtext	%%  text
  }


%%%%%
%% MemFold and MemEnvelope are both subtypes of Mem.  MemFold is for
%% fold-n-staple style mempackets, MemEnvelope is for stuff-n-seal
%% style mempackets.  If you want a mempacket to contain interesting
%% contents, like sheets, abilities, and other mempackets, use a
%% MemEnvelope.
\DECLARESUBTYPE{MemFold}{Mem}
\DECLARESUBTYPE{MemEnvelope}{Mem}


%%%%%
%% MemCover and MemPage are for the cover and pages of mempacket
%% booklets, which resemble research notebooks.  These are good
%% substitutes for large piles of MemFolds, and can be useful for
%% things like amnesiac characters.
%%
%% Like MemFolds, MemPages shouldn't directly own any other elements
%% as contents.  Use MemEnvelope instead.
%%
%% MemPages are usually assigned to a MemCover (via \MYmems), with the
%% MemCover representing the entire booklet and assigned to a
%% character.
%%
%% A MemCover is not a mempacket in and of itself; its name is not its
%% trigger and its text is not a memory.
\DECLARESUBTYPE{MemCover}{Mem}
\PRESETS{MemCover}{
  \sd\MYtext	{Each page is a memory/event packet with a separate
		trigger.}
  }

\DECLARESUBTYPE{MemPage}{Mem}


%%%%%
%% \memfold{<trigger>}{<text>}
%% \memenvelope{<trigger>}{<text>}
%% \memcover{<name>}{<pages>}
%% \mempage{<trigger>}{<text>}
%% \startmembook{<name>} <pages> \endmembook
%%
%% These are wrappers around \INSTANCE, useful as 1-shots.
%% \startmembook...\endmembook is a simple wrapper around \memcover
%% that may have better syntax for use within character sheets (inside
%% a \starttag{mems}...\endtag block).
\newinstance{MemFold}{\memfold[2]}{
  \s\MYname{#1}\s\MYtext{#2}}
\newinstance{MemEnvelope}{\memenvelope[2]}{
  \s\MYname{#1}\s\MYtext{#2}}
\newinstance{MemCover}{\memcover[2]}{
  \s\MYname{#1}\s\MYmems{#2}}
\newinstance{MemPage}{\mempage[2]}{
  \s\MYname{#1}\s\MYtext{#2}}

\long\def\startmembook#1#2\endmembook{\memcover{#1}{#2}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NEW{MemFold}{\mTest}{
  \s\MYname	{Test Trigger}
  \s\MYtext	{This is a Test of a fold-n-staple memory packet}
  }
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Semiramis
\NEW{MemFold}{\mGhostRecognition}{
  \s\MYname	{If you see Character #0016, open this. You may need special abilities for this character to be visible to you.}
  \s\MYtext	{Wow, she looks like Queen Smaragdos herself! You'd recognize those cheekbones anywhere . . .}
}
%Eidola, Max, Cryseon, Meizon
\NEW{MemFold}{\mFugitiveBirthday}{
  \s\MYname	{If you hear about the date "June 2," open this.}
  \s\MYtext	{Huh, that was \cFugitive's birthday.}
}
%Fresi
\NEW{MemFold}{\mFresiExplosives}{
  \s\MYname	{If you see Item 0007, open this.}
  \s\MYtext	{Sugar? Flour? No, this is something far more terrifying - it's one of the bags of experimental explosive stolen from your ship! What could it be doing here?}
}
%Fresi
\NEW{MemFold}{\mFresiPoisonOne}{
  \s\MYname	{If you see Item 0016, open this.}
  \s\MYtext	{This is poison.}
}
%Fresi
\NEW{MemFold}{\mFresiPoisonTwo}{
  \s\MYname	{If you see Item 0019, open this.}
  \s\MYtext	{This is poison.}
}
%Eidola
\NEW{MemFold}{\mAlcoholism}{
  \s\MYname	{Open this the first time you consume alcohol.}
  \s\MYtext	{Alas, you have relapsed into alcoholism. If you are offered a drink, you cannot refuse it. Additionally, you must consume at least two drinks every hour. Every time you finish a full hour without consuming two drinks, take three points of psychic damage.}
}
%Paldeen, Izdubar
\NEW{MemFold}{\mAllergy}{
  \s\MYname	{If you ingest Item 0010, open this.}
  \s\MYtext	{You start coughing uncontrollably. Your throat tightens, and you feel as if your lungs have filled up with fluid. Your CR goes down by 1, to a minimum of 0. These effects last for 5 minutes.}
}
%Hiems
\NEW{MemFold}{\mAchillea}{
  \s\MYname	{Open this if you hear the word "Achillea."}
  \s\MYtext	{Achillea-- that was a pathetic Scythian border town, wasn't it? You recall ordering its destruction for some reason or another, not long before Cerintha's death.}
}
%Leda
\NEW{MemEnvelope}{\mThief}{
  \s\MYname	{Open this when you see the Scythian fortune-teller.}
  \s\MYtext	{Something about this striking young diviner is hauntingly familiar. The lines of \cBurglar{\their} face, the defiant glint in \cBurglar{\their} eyes, \cBurglar{\their} regal poise and \cBurglar{\their} proud voice. You've not seen \cBurglar{\their} like in far too long. Then you remember: your guilty mind conjures up memories of the old Etruscan queen, before King Hyperion dethroned \cBurglar{\them} and left her to die. This diviner is \cBurglar{\their} spitting image! Perhaps \cBurglar{\they} too bears royal blood . . .}
}
%Fresi
\NEW{MemEnvelope}{\mHackEtruria}{
  \s\MYname	{Open this if you successfully hack communication machine 6666.}
  \s\MYtext	{The wiring here is more complex than the devices you're used to, but with a little finagling you're able to reverse-engineer the communicator and figure out what message each button will send. Pressing the button marked ''0'' will launch an all-out attack, pressing the button marked ''1'' will heighten the nation's border defenses, and pressing the button marked ''2'' will spark no additional military activity. Those tricky artificers switched around the classic codes!}
}
%Fresi
\NEW{MemEnvelope}{\mHackScythia}{
  \s\MYname	{Open this if you successfully hack communication machine 7777.}
  \s\MYtext	{The wiring here is more complex than the devices you're used to, but with a little finagling you're able to reverse-engineer the communicator and figure out what message each button will send. Pressing the button marked ''2'' will launch an all-out attack, pressing the button marked ''1'' will heighten the nation's border defenses, and pressing the buttons marked ''0'' or ''4'' will spark no additional military activity.}
}

%Meizon
\NEW{MemCover}{\mSickness}{
  \s\MYname	{Meizon}
  \s\MYmems	{\mSicknessOne{}\mSicknessTwo{}\mSicknessThree{}\mSicknessFour{}}
  }

\NEW{MemPage}{\mSicknessOne}{
  \s\MYname	{Open this 30 minutes into the game, provided you are alive.}
  \s\MYtext	{Your temples throb, and the room spins around you like a child's top. You blink, rubbing your brows, and the sensation fades, save a faint buzzing at the edges of your consciousness. You feel just a fraction colder than you did only minutes ago, but when you touch your forehead your skin is warm and clammy. Perhaps it was something you ate.}
  }

\NEW{MemPage}{\mSicknessTwo}{
  \s\MYname	{Open this packet 1 hour into the game, provided you are alive.}
  \s\MYtext	{The grating whispers in your mind grow louder and harsher, and your brain smolders with sudden pain. Your skin clings to your frame like waterlogged silk, and your hands gnarl and contort into ghastly claws, flickering as you gaze at them. Those around you cannot sense your agony, and you are powerless to tell them, a claustrophobic voice in a silent body. For the next five minutes, you can understand others, but cannot produce any verbal sounds of your own. In addition, your psychic health max decreases by 1.}
}

\NEW{MemPage}{\mSicknessThree}{
  \s\MYname	{Open this packet 2 hours into the game, provided you are alive.}
  \s\MYtext	{Your bones are as hollow as a minstrel's wooden flutes, and every gust of wind plays a dirge within your soul. The slightest touch feels like a thousand rats gnawing at your skin, their mouths stinking of leprous decay. You can feel the blood and pus and bile oozing through your veins, thin and lifeless. When you open your mouth to speak, your tongue is forked like a serpent's, and only a senseless, ceaseless babble emerges. For the next fifteen minutes, you can understand those around you, but you yourself can speak only gibberish. Your psychic health max decreases by 1.}
}

\NEW{MemPage}{\mSicknessFour}{
  \s\MYname	{Open this packet 2 hours and 45 minutes into the game, provided you are alive.}
  \s\MYtext	{Oh gods, oh gods, there is no mercy! The crystal of your soul is cracking into shards, filling your vision with impossible light, setting you adrift on a gray sea beneath gray sails. Every breath you take wraps its hands around your throat and begins to choke you. Tendrils of black lightning crawl beneath your skin, writhing and constricting until you cannot move your limbs. You can feel your heart begin to slow, each beat full of agony. Your psychic health max decreases by 4. If your psychic health max is now below or equal to 0, you die.}
}
